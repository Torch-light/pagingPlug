var pagging=angular.module("pagingPlug",[]);
pagging.directive("paging",["$http","$q","$rootScope",function(p,r,u){return{restrict:"E",replace:!0,scope:{model:"="},template:'<div class="pagging-div-warp"><ul class="ul-warp" ng-if="alldata>0"><button  class="btn" ng-click="page.onePage()" ng-disabled="indexPage==1">\u9996\u9875</button><button  class="btn" ng-click="page.upPage()" ng-disabled="indexPage==1">\u4e0a\u4e00\u9875</button><li class="num" ng-class={true:"active",false:"notactive"}[pagging==indexPage]  ng-repeat="pagging in paggingArr track by $index" ng-click="page.index(pagging)">{{pagging}}</li><button  class="btn" ng-click="page.downPage()" ng-disabled="indexPage==allpage">\u4e0b\u4e00\u9875</button><button  class="btn" ng-click="page.lastPage()" ng-disabled="indexPage==allpage">\u5c3e\u9875</button><span>\u8df3\u9875\u81f3<input ng-model="goIndex.index" ng-change="changeInputValue()"></span><button ng-click="page.sure()" class="btn" ng-if="goIndex.index">\u786e\u5b9a</button><span>\u5171{{allpage}}\u9875/{{alldata}}\u6761\u6570\u636e</span></ul></div>',link:function(a,
l,r){a.indexPage=1;a.goIndex={index:""};var c,q,d,g,m=null,h={},n=!0,e=[];l=1;if(a.model)for(var t in a.model)e[l]=a.model[t],l++;a.allpage=e[3];a.alldata=e[4];h=e[1];q=e[2];c=e[3];d=e[5]||6;g=e[6]||"get";var m=e[7]||null,k=Math.floor(d/2),f;a.apiCall={mosaic:function(a){var c="?",d;for(d in a)c=c+d+"="+a[d]+"&";return c=c.substr(0,c.length-1)},getRequest:function(){n=!0;for(var b in h)n&&(h[b]=a.indexPage,n=!1);b=[];b.$promise=null;g=g.toLowerCase();switch(g){case "get":b.$promise=p.get(q+a.apiCall.mosaic(h))}return b.$promise},
addToken:function(){0<e.length&&(m&&(p.defaults.headers.common=m),a.apiCall.getRequest().success(function(b){try{a.model.success.call(a.model,b)}catch(c){console.log(c+"\u8bf7\u5b9a\u4e49success\u51fd\u6570")}}))}};a.page={init:function(){a.paggingArr=[];c<d&&(d=c);for(var b=1;b<=d;b++)a.paggingArr[b-1]=b},createPage:function(){if(c>d)if(1>a.paggingArr[0]+f)a.page.init();else for(var b=1;b<=d;b++)a.paggingArr[b-1]+=f},index:function(b){f=b-a.paggingArr[k];b+f>c&&(f=c-b);a.indexPage=b;0<f&&a.paggingArr[d-
1]<c?a.page.createPage():0>f&&1<a.paggingArr[0]&&a.page.createPage();a.apiCall.addToken()},onePage:function(){1<a.indexPage&&(a.indexPage=1,a.apiCall.addToken(),a.page.init())},upPage:function(){--a.indexPage;1>a.indexPage&&(a.indexPage=1);a.page.index(a.indexPage)},downPage:function(){a.indexPage+=1;a.indexPage>c&&(a.indexPage=c);a.page.index(a.indexPage)},lastPage:function(){if(a.indexPage<c){a.indexPage=c;a.apiCall.addToken();for(var b=1;b<=d;b++)a.paggingArr[b-1]=c-d+b}},sure:function(){a.goIndex.index-=
0;a.indexPage=a.goIndex.index;if(a.indexPage+k<=c)for(var b=1;b<=d;b++){if(a.paggingArr[b-1]=a.indexPage+b-k,0>=a.paggingArr[b-1]){a.page.init();break}}else if(a.indexPage+k>c)for(b=1;b<=d;b++)a.paggingArr[b-1]=c-d+b;a.apiCall.addToken();a.goIndex.index=""}};a.changeInputValue=function(){a.goIndex.index>c&&(a.goIndex.index=c);1>a.goIndex.index&&(a.goIndex.index=1);"string"==typeof a.goIndex.index&&(a.goIndex.index=a.goIndex.index.replace(/\W|[a-z|A-Z]/g,""),a.goIndex.index=parseInt(a.goIndex.index))};
a.page.init()}}}]);